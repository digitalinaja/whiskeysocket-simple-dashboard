# ============================================
# WHISKEYSOCKET CRM - ENVIRONMENT CONFIGURATION
# ============================================
# Copy this file to .env and update with your actual values
# DO NOT commit .env file to version control

# ============================================
# APPLICATION CONFIGURATION
# ============================================

# Application environment: development, staging, production
NODE_ENV=production

# Application Name
APP_NAME=Whiskeysocket CRM

# Server Port
PORT=3000

# ============================================
# DATABASE CONFIGURATION (TiDB Cloud)
# ============================================

TIDB_HOST=gateway01.ap-southeast-1.prod.alicloud.tidbcloud.com
TIDB_PORT=4000
TIDB_USER=your_tidb_user
TIDB_PASSWORD=your_tidb_password
TIDB_DATABASE=whiskeysocket_crm

# ============================================
# AUTHENTICATION & JWT
# ============================================

# JWT Secret for token validation
JWT_SECRET=your-jwt-secret-key-here-change-in-production

# JWT Cookie name
JWT_COOKIE_NAME=crm_jwt_token

# Session Secret for express-session
SESSION_SECRET=your-session-secret-key-here-change-in-production

# External SSO Login URL
SSO_LOGIN_URL=https://sso.example.com/login

# Redirect URL after successful SSO login
SSO_REDIRECT_URL=https://your-app.com

# ============================================
# GOOGLE OAUTH (Contact Sync)
# ============================================

GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URI=http://localhost:3000/auth/google/callback

# ============================================
# MICROSOFT OFFICE 365 OAUTH (Outlook Contact Sync)
# ============================================

# Microsoft Azure App Registration - Client ID
MICROSOFT_CLIENT_ID=your-microsoft-application-client-id

# Microsoft Azure App Registration - Client Secret
MICROSOFT_CLIENT_SECRET=your-microsoft-client-secret

# Microsoft Tenant ID (use 'common' for multi-tenant, or specific tenant ID)
MICROSOFT_TENANT_ID=common

# OAuth Redirect URI (must match exactly in Azure App Registration)
MICROSOFT_REDIRECT_URI=http://localhost:3000/auth/microsoft/callback

# Application Base URL (for generating correct redirect URIs)
BASE_URL=http://localhost:3000

# ============================================
# SCHOOL SSO INTEGRATION
# ============================================

# SSO API Base URL
SSO_API_BASE_URL=https://sso-sekolah-api.example.com/api

# SSO API Key for authentication
SSO_API_KEY=your-sso-api-key-here

# SSO API Request Timeout (milliseconds)
SSO_API_TIMEOUT=30000

# ============================================
# EXTERNAL SYSTEM INTEGRATION
# ============================================

# Student Database API
EXTERNAL_STUDENT_API_URL=https://api.student-system.com/api
EXTERNAL_STUDENT_API_KEY=your-student-api-key

# Payment System API
EXTERNAL_PAYMENT_API_URL=http://localhost:3002/api
EXTERNAL_PAYMENT_API_KEY=your-payment-api-key

# Ticketing System API
EXTERNAL_TICKETING_API_URL=http://localhost:3003/api
EXTERNAL_TICKETING_API_KEY=your-ticketing-api-key

# ============================================
# SYNC CONFIGURATION
# ============================================

# Batch size for database sync operations
SYNC_BATCH_SIZE=100

# Retry attempts for failed sync operations
SYNC_RETRY_ATTEMPTS=3

# Delay between retry attempts (milliseconds)
SYNC_RETRY_DELAY_MS=5000

# Request timeout for external API calls (milliseconds)
SYNC_TIMEOUT_MS=30000

# ============================================
# ACTIVITY LOGGING & AUDIT
# ============================================

# Enable/disable audit logging
AUDIT_LOG_ENABLED=true

# Auto-log incoming WhatsApp messages as activities
ACTIVITY_AUTO_LOG_WHATSAPP=true

# Audit log retention period (days)
AUDIT_LOG_RETENTION_DAYS=365

# ============================================
# WEBHOOK SECURITY
# ============================================

# Secret key for webhook signature validation (HMAC-SHA256)
WEBHOOK_SECRET=your-webhook-secret-key-change-in-production

# Webhook timestamp tolerance in milliseconds (prevent replay attacks)
WEBHOOK_TIMESTAMP_TOLERANCE_MS=300000

# ============================================
# PERFORMANCE & CACHING
# ============================================

# Cache TTL for activity types (seconds, 24 hours)
CACHE_TTL_ACTIVITY_TYPES=86400

# Cache TTL for lead statuses (seconds, 24 hours)
CACHE_TTL_LEAD_STATUSES=86400

# Cache TTL for contact types (seconds, 1 hour)
CACHE_TTL_CONTACT_TYPES=3600

# Enable/disable query result caching
ENABLE_QUERY_CACHING=true

# ============================================
# RATE LIMITING
# ============================================

# Rate limit time window (milliseconds)
RATE_LIMIT_WINDOW_MS=60000

# Maximum requests per time window
RATE_LIMIT_MAX_REQUESTS=1000

# Enable/disable rate limiting
ENABLE_RATE_LIMITING=true

# ============================================
# CIRCUIT BREAKER (External API Resilience)
# ============================================

# Consecutive failures before opening circuit
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# Time to wait before trying half-open state (milliseconds)
CIRCUIT_BREAKER_RESET_TIMEOUT_MS=30000

# Number of requests to test in half-open state
CIRCUIT_BREAKER_HALF_OPEN_REQUESTS=1

# ============================================
# DEFAULT VALUES
# ============================================

# Default session ID if not specified in requests
DEFAULT_SESSION_ID=default

# ============================================
# LOGGING & DEBUGGING
# ============================================

# Log level: debug, info, warn, error
LOG_LEVEL=info

# Enable request logging
LOG_REQUESTS=true

# ============================================
# SCHEMA VERSION
# ============================================

# Current database schema version
# This is updated during migrations and should not be changed manually
SCHEMA_VERSION=1.5.0

# ============================================
# NOTES
# ============================================
# - All API keys and secrets should be strong and unique
# - In production, use environment-specific secrets management
# - For TiDB Cloud, use cluster SSL certificates
# - Test webhook endpoints before deploying
# - Rotate webhook secrets periodically
# - Monitor rate limiting and adjust thresholds as needed
